<!DOCTYPE html>
<!--
    WTF-Generator for generating messages following a WTF moment.
    Copyright (C) 2014  Mark Gibbs (aka Delsim)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style>
body { background-color: red; color: white; }
.generator h1 { font-size: 8em; margin: 0 0 0 0;}
    </style>
    <title>WTF Generator</title>
  </head>
  <body ng-app="wtf">
    <div class="generator" ng-controller="WTFCtrl">
      <h1>WTF</h1>
{{email.body}}
      <ul ng-controller="SymptomsCtrl"><wtfitems/></ul>
      <div>
Source of bewilderment:
        <input type="text" ng-model="selections.bewilderment" ng-change="build_body()"/>
      </div>
      <div>
Can you help me out here and
        <ul ng-controller="ResolutionsCtrl"><wtfitems/></ul>
      </div>
      <ul ng-controller="AnnotationsCtrl"><wtfitems/></ul>
      <a ng-href="mailto:{{email.target}}?subject={{email.subject}}&body={{email.body}}">WTF Generate!</a>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.min.js"></script>
    <script src="http://localhost:8400/static/js/angular.js"></script>
    <script>
angular.module("wtf",[])
  .controller('WTFCtrl',['$scope',function($scope){
      $scope.annotations = ['FYI','FML','OMG','LOL'];
      $scope.resolutions = ['Stop','Advise','Explain','Rescue me','Intervene','Dial 911'];
      $scope.symptoms = ['Are you thinking','Are they thinking','Is going on','Was that','Did you think would happen','Seriously','I mean, simply, WTFF'];
      $scope.email = {target:"a.person@example.com",subject:"WTF",body:"WTF Dude"};
      $scope.selections = {
          symptoms : {},
          resolutions : {},
          annotations : {},
          bewilderment: ""
      };
      $scope.build_body = function() {
          $scope.email.body = "We have had an WTF moment. To be clear: ";
          for(var k in $scope.selections.symptoms) {
              if( $scope.selections.symptoms[k] )
                  $scope.email.body += " WTF " + k;
          };
          if( $scope.selections.bewilderment.length > 1 )
              $scope.email.body += " Source of bewilderment: " + $scope.selections.bewilderment;
          for(var k in $scope.selections.resolutions) {
              if( $scope.selections.resolutions[k] )
                  $scope.email.body += " Please " + k + ".";
          };
          for(var k in $scope.selections.annotations) {
              if( $scope.selections.annotations[k] )
                  $scope.email.body += " " + k + ".";
          };
      };
  }])
  .controller('SymptomsCtrl',['$scope',function($scope) { $scope.category = "symptoms"; $scope.items = $scope.symptoms; }])
  .controller('ResolutionsCtrl',['$scope',function($scope) { $scope.category = "resolutions"; $scope.items = $scope.resolutions; }])
  .controller('AnnotationsCtrl',['$scope',function($scope) { $scope.category = "annotations"; $scope.items = $scope.annotations; }])
  .controller('ToggleCtrl',['$scope','$timeout',function($scope,$timeout){
      $scope.selected = false;
      $scope.$watch("selected",function(selected) {
          $scope.selections[$scope.category][$scope.item] = selected;
          $scope.build_body();
      });
  }])
  .directive("wtfitems",function(){
      return {
          restrict: 'E',
          replace: 'true',
          template: '<li ng-repeat="item in items" ng-controller="ToggleCtrl"><input type="checkbox" ng-model="selected"/>{{item}}</li>'
      };
  })
;
    </script>
  </body>
</html>
