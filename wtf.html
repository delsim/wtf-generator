<!DOCTYPE html>
<!--
    WTF-Generator for generating messages following a WTF moment.
    Copyright (C) 2014  Mark Gibbs (aka Delsim)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style>
body { background-color: red; color: white; }
.generator h1 { font-size: 8em; margin: 0 0 0 0;}
    </style>
    <title>WTF Generator</title>
  </head>
  <body ng-app="wtf">
    <div class="generator" ng-controller="WTFCtrl">
      <h1>WTF</h1>
        Dear <input type="text" ng-model="selections.name" ng-change="build_body()"/>
{{email.body}}
      <ul ng-controller="SymptomsCtrl"><wtfitems/></ul>
      <div>
Source of bewilderment:
        <input type="text" ng-model="selections.bewilderment" ng-change="build_body()"/>
      </div>
      <div>
Can you help me out here and
        <ul ng-controller="ResolutionsCtrl"><wtfitems/></ul>
      </div>
      <ul ng-controller="AnnotationsCtrl"><wtfitems/></ul>
      <a ng-href="mailto:{{email.target}}?subject={{email.subject}}&body={{email.body}}">WTF Generate!</a>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.min.js"></script>
    <script src="http://localhost:8400/static/js/angular.js"></script>
    <script>
angular.module("wtf",[])
  .controller('WTFCtrl',['$scope',function($scope){
      $scope.annotations = [['FYI','FYI'],['FML','FML'],['OMG','OMG'],['LOL','LOL']];
      $scope.resolutions = [['Stop','Please stop it.'],['Advise','Please advise.'],['Explain','Can you explain it to me?'],['Rescue me','Please rescue me'],['Intervene','I need an intervention.'],['Dial 911','Get a phone and dial 911 immediately.']];
      $scope.symptoms = [['Are you thinking','WTF are you thinking?'],['Are they thinking','WTF are they thinking?'],['Is going on','WTF is going on'],['Was that','WTF was that'],['Did you think would happen','WTF did you think would happen'],['Seriously','Seriously, WTF. Seriously.'],['I mean, simply, WTFF','I mean, simply, WTFF.']];
      $scope.email = {target:"a.person@example.com",subject:"WTF",body:"WTF Dude"};
      $scope.selections = {
          symptoms : {},
          resolutions : {},
          annotations : {},
          bewilderment: ""
      };
      $scope.handle_items = function(map) {
          for(var key in map) {
              if( map[key] )
                  $scope.email.body += " " + map[key];
          };
      };
      $scope.build_body = function() {
          $scope.email.body = "Dear "+$scope.selections.name+" We have had an WTF moment. To be clear: ";
          $scope.handle_items($scope.selections.symptoms);
          if( $scope.selections.bewilderment.length > 1 )
              $scope.email.body += " Source of bewilderment: " + $scope.selections.bewilderment;
          $scope.handle_items($scope.selections.resolutions);
          $scope.handle_items($scope.selections.annotations);
      };
  }])
  .controller('SymptomsCtrl',['$scope',function($scope) { $scope.category = "symptoms"; $scope.items = $scope.symptoms; }])
  .controller('ResolutionsCtrl',['$scope',function($scope) { $scope.category = "resolutions"; $scope.items = $scope.resolutions; }])
  .controller('AnnotationsCtrl',['$scope',function($scope) { $scope.category = "annotations"; $scope.items = $scope.annotations; }])
  .controller('ToggleCtrl',['$scope','$timeout',function($scope,$timeout){
      $scope.selected = false;
      $scope.$watch("selected",function(selected) {
          if( selected ) {
              $scope.selections[$scope.category][$scope.item[0]] = $scope.item[1];
          } else {
              $scope.selections[$scope.category][$scope.item[0]] = false;
          }
          $scope.build_body();
      });
  }])
  .directive("wtfitems",function(){
      return {
          restrict: 'E',
          replace: 'true',
          template: '<li ng-repeat="item in items" ng-controller="ToggleCtrl"><input type="checkbox" ng-model="selected"/>{{item[0]}}</li>'
      };
  })
;
    </script>
  </body>
</html>
