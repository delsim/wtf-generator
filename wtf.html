<!DOCTYPE html>
<!--
    WTF-Generator for generating messages following a WTF moment.
    Copyright (C) 2014  Mark Gibbs (aka Delsim)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style>
body { background-color: red; color: white; }
.generator h1 { font-size: 8em; margin: 0 0 0 0;}
    </style>
    <title>WTF Generator</title>
  </head>
  <body ng-app="wtf">
    <div class="generator" ng-controller="WTFCtrl">
      <h1>WTF</h1>
{{email.body}} and {{ selections }}
      <div>
        <ul ng-controller="SymptomsCtrl">
          <li ng-repeat="item in items" ng-controller="ToggleCtrl"><input type="checkbox" ng-model="selected"/>{{item}} {{selected}}</li>
          <li>???</li>
        </ul>
      </div>
      <div>
Source of bewilderment:
      </div>
      <div>
Can you help me out here and
        <ul ng-controller="ResolutionsCtrl">
          <li ng-repeat="item in items" ng-controller="ToggleCtrl"><input type="checkbox" ng-model="selected"/>{{item}} {{selected}}</li>
          <li>???</li>
        </ul>
      </div>
      <div>
        <ul ng-controller="AnnotationsCtrl">
          <li ng-repeat="item in items" ng-controller="ToggleCtrl"><input type="checkbox" ng-model="selected"/>{{item}} {{selected}}</li>
        </ul>
      </div>
      <a ng-href="mailto:{{email.target}}?subject={{email.subject}}&body={{email.body}}">WTF Generate!</a>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.min.js"></script>
    <script src="http://localhost:8400/static/js/angular.js"></script>
    <script>
angular.module("wtf",[])
  .controller('WTFCtrl',['$scope',function($scope){
      $scope.fred = "jim";
      $scope.annotations = ['FYI','FML','OMG','LOL'];
      $scope.resolutions = ['Stop','Advise','Explain','Rescue me','Intervene','Dial 911'];
      $scope.symptoms = ['Are you thinking','Are they thinking','Is going on','Was that','Did you think would happen','Seriously','I mean, simply, WTFF'];
      $scope.email = {target:"a.person@example.com",subject:"WTF",body:"WTF Dude"};
      $scope.selections = {
          symptoms : {},
          resolutions : {},
          annotations : {}
      };
      // TODO replace this with proper body generation
      // and also escaping
      $scope.counter = 1;
      $scope.build_body = function() {
          $scope.email.body = "blah " + $scope.counter;
          $scope.counter += 1;
      };
  }])
  .controller('SymptomsCtrl',['$scope',function($scope) { $scope.category = "symptoms"; $scope.items = $scope.symptoms; }])
  .controller('ResolutionsCtrl',['$scope',function($scope) { $scope.category = "resolutions"; $scope.items = $scope.resolutions; }])
  .controller('AnnotationsCtrl',['$scope',function($scope) { $scope.category = "annotations"; $scope.items = $scope.annotations; }])
  .controller('ToggleCtrl',['$scope','$timeout',function($scope,$timeout){
      $scope.selected = false;
      $scope.$watch("selected",function(selected) {
          $scope.selections[$scope.category][$scope.item] = selected;
          $scope.build_body();
      });
  }])
;
    </script>
  </body>
</html>
